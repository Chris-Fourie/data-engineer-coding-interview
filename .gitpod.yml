tasks:
  - name: Prebuild terraform
    init: |
      sudo apt-get update
      sudo apt-get install -y wget unzip
      wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
      echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
      sudo apt update && sudo apt install terraform
      terraform version
  - name: Prebuild aws
    init: |
      sudo apt-get install -y awscli
      aws sts assume-role --role-arn "arn:aws:iam::926103658615:role/gitpod_terraform" --role-session-name "MySession" > assumed-role.json
      export AWS_ACCESS_KEY_ID=$(jq -r '.Credentials.AccessKeyId' assumed-role.json)
      export AWS_SECRET_ACCESS_KEY=$(jq -r '.Credentials.SecretAccessKey' assumed-role.json)
      export AWS_SESSION_TOKEN=$(jq -r '.Credentials.SessionToken' assumed-role.json)
